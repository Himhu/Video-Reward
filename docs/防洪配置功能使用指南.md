# 防洪配置功能使用指南

**文档版本**: 1.0  
**创建日期**: 2025-08-10  
**适用版本**: 修复后的防洪配置系统  

---

## 📋 功能概述

防洪配置页面提供了多种防封防洪策略，帮助保护您的服务免受封禁和限制。本指南将详细介绍每个功能的使用方法。

## 🔧 功能列表

### 1. URL加密 ✅

**功能描述**: 启用后对生成的链接进行加密处理，增加识别难度

**使用方法**:
1. 进入防洪配置页面
2. 找到"URL加密"开关
3. 切换到 **ON** 状态
4. 系统自动保存配置（无需手动点击确认）

**效果**: 所有通过系统生成的链接将经过加密算法处理

### 2. 域名随机前缀 ✅

**功能描述**: 启用后系统将为域名自动添加随机前缀，提升防护效果

**使用方法**:
1. 进入防洪配置页面
2. 找到"域名随机前缀"开关
3. 切换到 **ON** 状态
4. 系统自动保存配置（无需手动点击确认）

**效果示例**:
- `example.com` → `app.example.com`
- `test.com` → `mobile.test.com`
- `api.domain.com` → `cdn.domain.com`

**前缀池**: 支持23种常见前缀（m、www、app、api、cdn、static、img、js、css、admin、user、mobile、wap、h5、web、service、data、file、upload、download、media、assets）

### 3. 禁止PC端打开 ✅

**功能描述**: 启用后限制PC端设备访问，仅允许移动端用户访问

**使用方法**:
1. 进入防洪配置页面
2. 找到"禁止pc端打开"开关
3. 切换到 **ON** 状态
4. 系统自动保存配置（无需手动点击确认）

**效果**: PC端用户访问时将被重定向或显示提示信息

## 🎯 使用流程

### 标准操作流程

1. **访问配置页面**
   - 登录后台管理系统
   - 导航到防洪配置页面

2. **配置功能开关**
   - 根据需要切换各功能开关
   - 系统自动保存配置并显示"配置已自动保存"提示

3. **验证效果**
   - 使用"测试功能"按钮验证域名随机前缀
   - 检查前端页面确认其他功能生效

4. **批量保存（可选）**
   - 如需批量保存文本类配置，可点击"批量保存"按钮
   - 开关类配置无需手动保存

### 验证域名随机前缀功能

1. **启用功能**
   - 确保"域名随机前缀"开关为 ON
   - 系统自动保存配置

2. **验证效果**
   - 查看系统生成的实际链接
   - 观察域名是否包含随机前缀
   - 确认防护效果是否生效

## ⚠️ 注意事项

### 重要提醒

1. **自动保存**: 开关切换后系统自动保存，无需手动操作
2. **缓存清理**: 配置更改后系统会自动清理相关缓存
3. **域名管理**: 确保系统中已配置相应的域名资源
4. **生产环境**: 当前为正式环境配置，已移除测试功能

### 故障排除

**问题**: 开关切换后功能不生效
**解决**:
1. 检查开关是否显示"配置已自动保存"提示
2. 刷新页面确认开关状态
3. 查看系统日志确认错误信息

**问题**: 域名随机前缀不生效
**解决**:
1. 确认开关已开启并显示保存成功
2. 检查域名管理中是否有可用域名
3. 观察实际生成的链接是否包含前缀

## 📊 技术说明

### 实现原理

- **域名随机前缀**: 通过修改 `getDomain()` 函数实现，在返回域名时自动添加随机前缀
- **配置存储**: 所有配置存储在 `system_config` 表的 `ff` 分组中
- **前端交互**: 使用 Layui 框架实现开关组件和表单提交

### 相关文件

- **配置页面**: `app/admin/view/system/config/ff.html`
- **核心函数**: `app/common.php` 中的 `getRandomDomainPrefix()` 和 `getDomain()`
- **测试接口**: `app/admin/controller/Hezi.php` 中的 `testDomainPrefix()`
- **配置控制器**: `app/admin/controller/system/Config.php`

---

## 🎉 总结

防洪配置功能现已完全修复并可正常使用。通过合理配置这些功能，可以有效提升系统的防封能力和安全性。

如有问题，请查看系统日志或联系技术支持。
