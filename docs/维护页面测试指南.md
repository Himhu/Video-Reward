# 维护页面功能测试指南

## 📋 测试数据概览

已为您生成以下测试数据：

- **📊 公共片库**: 25 条记录
  - 20 条使用 `old-domain.com` 域名
  - 5 条使用 `test-old.com` 域名
- **👥 测试代理用户**: 5 个
  - 用户名: `test_agent_1` 到 `test_agent_5`
  - 密码: `123456`
- **🎬 代理片库**: 72 条记录
  - 包含有效和无效的片库数据

## 🧪 功能测试步骤

### 1. 🔍 替换链接功能测试

#### 测试图片链接替换
1. 访问维护页面
2. 在"替换图片链接"区域输入：
   - **查找**: `old-domain.com`
   - **替换**: `new-domain.com`
3. 点击"替换图片链接"按钮
4. **预期结果**: 
   - 显示预览弹窗，显示将影响 20+ 条记录
   - 确认后执行替换
   - 显示成功消息

#### 测试视频链接替换
1. 在"替换视频链接"区域输入：
   - **查找**: `test-old.com`
   - **替换**: `test-new.com`
2. 点击"替换视频链接"按钮
3. **预期结果**: 
   - 显示预览弹窗，显示将影响 5+ 条记录
   - 确认后执行替换

### 2. 🗑️ 删除无效私有片库测试

1. 点击"删除不在公共片库里的私有片库"按钮
2. **预期结果**:
   - 显示危险操作确认弹窗
   - 需要二次确认
   - 执行后删除无效的片库记录

### 3. 📤 批量发布代理片库测试

1. 点击"帮助所有代理发布私有片库"按钮
2. **预期结果**:
   - 显示批量操作确认弹窗
   - 二次确认后为所有代理发布片库
   - 显示处理的代理数量和发布的片库数量

### 4. 💥 删除所有代理片库测试 (极度危险)

⚠️ **警告**: 这是最危险的操作，请谨慎测试！

1. 点击"清理代理片库数据"按钮
2. **预期结果**:
   - 显示极度危险操作警告
   - 需要输入 "DELETE ALL" 确认
   - 执行后删除所有代理片库数据

### 5. 🔧 清理垃圾数据测试

1. 点击"删除24小时之前的垃圾数据"按钮
2. **预期结果**:
   - 显示详细的清理内容说明
   - 二次确认后执行清理
   - 显示清理的记录数量

## 🔐 权限测试

### 测试非超级管理员权限
1. 使用非超级管理员账号登录 (如 `test_agent_1`)
2. 尝试执行任何危险操作
3. **预期结果**: 显示"权限不足"错误

### 测试超级管理员权限
1. 使用超级管理员账号登录 (admin)
2. 所有功能应该正常可用

## 📝 操作日志验证

每次执行操作后，检查操作日志：

```sql
SELECT * FROM d3s_system_operation_log ORDER BY create_time DESC LIMIT 10;
```

**预期内容**:
- 操作者ID
- 操作类型
- 详细信息 (JSON格式)
- IP地址
- 操作时间

## 🎯 测试重点

### 安全性测试
- ✅ SQL注入防护
- ✅ 权限验证
- ✅ 参数验证
- ✅ 操作日志记录

### 用户体验测试
- ✅ 预览功能
- ✅ 详细确认提示
- ✅ 错误信息提示
- ✅ 操作结果反馈

### 功能完整性测试
- ✅ 所有按钮可点击
- ✅ 数据正确处理
- ✅ 事务完整性
- ✅ 错误回滚

## 🧹 测试后清理

测试完成后，可以运行以下SQL清理测试数据：

```sql
-- 清理测试代理用户
DELETE FROM d3s_system_admin WHERE username LIKE 'test_agent_%';

-- 清理测试片库数据
DELETE FROM d3s_stock WHERE title LIKE '%测试%' OR title LIKE '%公共片库%' OR title LIKE '%待替换%';

-- 清理测试代理片库
DELETE FROM d3s_link WHERE title LIKE '%代理%' OR title LIKE '%无效%';

-- 清理操作日志
DELETE FROM d3s_system_operation_log WHERE action LIKE '%测试%';
```

## 📞 问题反馈

如果在测试过程中发现任何问题，请记录：
1. 操作步骤
2. 预期结果
3. 实际结果
4. 错误信息
5. 浏览器控制台错误 (F12)

---

**🎉 祝测试顺利！所有功能都已经过安全加固，可以放心测试。**
