<div class="layuimini-container">
    <div class="layuimini-main">

        <fieldset id="" class="table-search-fieldset " style="margin-bottom: 1%">
            <legend>个人流水统计</legend>
            <table class="table layui-table " >
                <thead>
                <tr>
                    <th style="text-align: center;">总记录数</th>
                    <th style="text-align: center;">今日记录</th>
                    <th style="text-align: center;">总收入</th>
                    <th style="text-align: center;">今日收入</th>
                    <th style="text-align: center;">总支出</th>
                    <th style="text-align: center;">今日支出</th>
                    <th style="text-align: center;">净收益</th>
                </tr>
                </thead>
                <tbody>
                <tr class="text-center">
                    <td><?php echo isset($statistics['total_records']) ? $statistics['total_records'] : 0;?></td>
                    <td><?php echo isset($statistics['today_records']) ? $statistics['today_records'] : 0;?></td>
                    <td class="text-success">￥<?php echo isset($statistics['total_income']) ? $statistics['total_income'] : '0.00';?></td>
                    <td class="text-success">￥<?php echo isset($statistics['today_income']) ? $statistics['today_income'] : '0.00';?></td>
                    <td class="text-danger">￥<?php echo isset($statistics['total_expense']) ? $statistics['total_expense'] : '0.00';?></td>
                    <td class="text-danger">￥<?php echo isset($statistics['today_expense']) ? $statistics['today_expense'] : '0.00';?></td>
                    <td class="<?php echo (isset($statistics['net_amount']) && $statistics['net_amount'] >= 0) ? 'text-success' : 'text-danger';?>">
                        ￥<?php echo isset($statistics['net_amount']) ? $statistics['net_amount'] : '0.00';?>
                    </td>
                </tr>
                </tbody>
            </table>
        </fieldset>

        <blockquote class="layui-elem-quote"  style="margin-bottom: 15px">
            个人流水说明:
            <br>
            这里显示您个人的所有资金流水记录。
            <br>
            包括收入、支出、余额变动等详细信息。
            <br>
            您只能查看自己的流水记录，无法查看其他用户的信息。
        </blockquote>

        <table id="currentTable" class="layui-table layui-hide"
               data-auth-add="{:auth('adaccount/add')}"
               data-auth-edit="{:auth('adaccount/edit')}"
               data-auth-delete="{:auth('adaccount/delete')}"
               lay-filter="currentTable">
        </table>
    </div>
</div>

<script>
layui.use(['table', 'form'], function () {
    var $ = layui.jquery,
        table = layui.table,
        form = layui.form;

    table.render({
        elem: '#currentTable',
        url: '{:url("adaccount/getList")}',
        where: {type: 'personal'},
        toolbar: '#toolbarDemo',
        defaultToolbar: ['filter', 'exports', 'print'],
        cols: [[
            {type: "checkbox", width: 50},
            {field: 'id', width: 80, title: 'ID', sort: true},
            {field: 'username', width: 120, title: '用户'},
            {field: 'type', width: 100, title: '类型', templet: function(d){
                if (d.type == 1) {
                    return '<span class="layui-badge layui-bg-green">收入</span>';
                } else if (d.type == 2) {
                    return '<span class="layui-badge layui-bg-red">支出</span>';
                } else {
                    return '<span class="layui-badge layui-bg-gray">未知</span>';
                }
            }},
            {field: 'money_formatted', width: 120, title: '变动金额', templet: function(d){
                var className = d.type == 1 ? 'text-success' : 'text-danger';
                var symbol = d.type == 1 ? '+' : '-';
                return '<span class="' + className + '">' + symbol + '￥' + d.money_formatted + '</span>';
            }},
            {field: 'before_formatted', width: 120, title: '变动前余额', templet: function(d){
                return '￥' + d.before_formatted;
            }},
            {field: 'after_formatted', width: 120, title: '变动后余额', templet: function(d){
                return '￥' + d.after_formatted;
            }},
            {field: 'remark', width: 200, title: '备注'},
            {field: 'create_time_formatted', width: 160, title: '创建时间'},
            {title: '操作', width: 150, templet: '#currentTableBar', fixed: "right", align: "center"}
        ]],
        limits: [10, 15, 20, 25, 50, 100],
        limit: 15,
        page: true
    });

    // 监听工具条
    table.on('tool(currentTable)', function (obj) {
        var data = obj.data;
        if (obj.event === 'detail') {
            layer.open({
                type: 1,
                title: '流水详情',
                content: '<div style="padding: 20px;">' +
                    '<p><strong>流水ID:</strong> ' + data.id + '</p>' +
                    '<p><strong>用户:</strong> ' + data.username + '</p>' +
                    '<p><strong>类型:</strong> ' + (data.type == 1 ? '收入' : '支出') + '</p>' +
                    '<p><strong>变动金额:</strong> ￥' + data.money_formatted + '</p>' +
                    '<p><strong>变动前余额:</strong> ￥' + data.before_formatted + '</p>' +
                    '<p><strong>变动后余额:</strong> ￥' + data.after_formatted + '</p>' +
                    '<p><strong>备注:</strong> ' + (data.remark || '-') + '</p>' +
                    '<p><strong>创建时间:</strong> ' + data.create_time_formatted + '</p>' +
                    '</div>',
                area: ['500px', '400px']
            });
        }
    });

    // 监听工具栏事件
    table.on('toolbar(currentTable)', function(obj){
        switch(obj.event){
            case 'refresh':
                table.reload('currentTable');
                layer.msg('数据已刷新');
                break;
            case 'export':
                layer.msg('导出功能开发中...');
                break;
        }
    });
});
</script>

<script type="text/html" id="currentTableBar">
    <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
</script>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="refresh">刷新数据</button>
        <button class="layui-btn layui-btn-sm" lay-event="export">导出数据</button>
    </div>
</script>
