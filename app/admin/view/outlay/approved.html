<div class="layuimini-container">
    <div class="layuimini-main">

        <fieldset id="" class="table-search-fieldset " style="margin-bottom: 1%">
            <legend>已批准提现统计</legend>
            <table class="table layui-table " >
                <thead>
                <tr>
                    <th style="text-align: center;">已批准笔数</th>
                    <th style="text-align: center;">已批准金额</th>
                    <th style="text-align: center;">今日批准</th>
                    <th style="text-align: center;">今日金额</th>
                </tr>
                </thead>
                <tbody>
                <tr class="text-center">
                    <td><?php echo isset($statistics['total_count']) ? $statistics['total_count'] : 0;?></td>
                    <td>￥<?php echo isset($statistics['total_amount']) ? $statistics['total_amount'] : '0.00';?></td>
                    <td><?php echo isset($statistics['today_count']) ? $statistics['today_count'] : 0;?></td>
                    <td>￥<?php echo isset($statistics['today_amount']) ? $statistics['today_amount'] : '0.00';?></td>
                </tr>
                </tbody>
            </table>
        </fieldset>

        <table id="currentTable" class="layui-table layui-hide"
               data-auth-add="{:auth('outlay/add')}"
               data-auth-edit="{:auth('outlay/edit')}"
               data-auth-delete="{:auth('outlay/delete')}"
               lay-filter="currentTable">
        </table>
    </div>
</div>

<script>
layui.use(['table', 'form'], function () {
    var $ = layui.jquery,
        table = layui.table,
        form = layui.form;

    table.render({
        elem: '#currentTable',
        url: '{:url("outlay/getList")}',
        where: {status: 'approved'},
        toolbar: '#toolbarDemo',
        defaultToolbar: ['filter', 'exports', 'print'],
        cols: [[
            {type: "checkbox", width: 50},
            {field: 'id', width: 80, title: 'ID', sort: true},
            {field: 'uid', width: 100, title: '用户ID'},
            {field: 'money', width: 120, title: '提现金额', templet: function(d){
                return '￥' + parseFloat(d.money).toFixed(2);
            }},
            {field: 'bank_name', width: 150, title: '银行名称'},
            {field: 'bank_account', width: 180, title: '银行账号'},
            {field: 'create_time', width: 160, title: '申请时间', templet: function(d){
                return new Date(d.create_time * 1000).toLocaleString();
            }},
            {field: 'approve_time', width: 160, title: '批准时间', templet: function(d){
                return d.approve_time ? new Date(d.approve_time * 1000).toLocaleString() : '-';
            }},
            {field: 'approve_remark', width: 150, title: '批准备注'},
            {field: 'status', width: 100, title: '状态', templet: function(d){
                return '<span class="layui-badge layui-bg-green">已批准</span>';
            }},
            {title: '操作', width: 150, templet: '#currentTableBar', fixed: "right", align: "center"}
        ]],
        limits: [10, 15, 20, 25, 50, 100],
        limit: 15,
        page: true
    });

    // 监听工具条
    table.on('tool(currentTable)', function (obj) {
        var data = obj.data;
        if (obj.event === 'detail') {
            layer.open({
                type: 1,
                title: '提现详情',
                content: '<div style="padding: 20px;">' +
                    '<p><strong>提现ID:</strong> ' + data.id + '</p>' +
                    '<p><strong>用户ID:</strong> ' + data.uid + '</p>' +
                    '<p><strong>提现金额:</strong> ￥' + parseFloat(data.money).toFixed(2) + '</p>' +
                    '<p><strong>银行名称:</strong> ' + data.bank_name + '</p>' +
                    '<p><strong>银行账号:</strong> ' + data.bank_account + '</p>' +
                    '<p><strong>申请时间:</strong> ' + new Date(data.create_time * 1000).toLocaleString() + '</p>' +
                    '<p><strong>批准时间:</strong> ' + (data.approve_time ? new Date(data.approve_time * 1000).toLocaleString() : '-') + '</p>' +
                    '<p><strong>批准备注:</strong> ' + (data.approve_remark || '-') + '</p>' +
                    '</div>',
                area: ['500px', '400px']
            });
        }
    });
});
</script>

<script type="text/html" id="currentTableBar">
    <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
</script>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="export">导出数据</button>
    </div>
</script>
