<div class="layuimini-container">
    <div class="layuimini-main">

        <fieldset id="" class="table-search-fieldset " style="margin-bottom: 1%">
            <legend>已拒绝提现统计</legend>
            <table class="table layui-table " >
                <thead>
                <tr>
                    <th style="text-align: center;">已拒绝笔数</th>
                    <th style="text-align: center;">已拒绝金额</th>
                    <th style="text-align: center;">今日拒绝</th>
                    <th style="text-align: center;">今日金额</th>
                </tr>
                </thead>
                <tbody>
                <tr class="text-center">
                    <td><?php echo isset($statistics['total_count']) ? $statistics['total_count'] : 0;?></td>
                    <td>￥<?php echo isset($statistics['total_amount']) ? $statistics['total_amount'] : '0.00';?></td>
                    <td><?php echo isset($statistics['today_count']) ? $statistics['today_count'] : 0;?></td>
                    <td>￥<?php echo isset($statistics['today_amount']) ? $statistics['today_amount'] : '0.00';?></td>
                </tr>
                </tbody>
            </table>
        </fieldset>

        <table id="currentTable" class="layui-table layui-hide"
               data-auth-add="{:auth('outlay/add')}"
               data-auth-edit="{:auth('outlay/edit')}"
               data-auth-delete="{:auth('outlay/delete')}"
               lay-filter="currentTable">
        </table>
    </div>
</div>

<script>
layui.use(['table', 'form'], function () {
    var $ = layui.jquery,
        table = layui.table,
        form = layui.form;

    table.render({
        elem: '#currentTable',
        url: '{:url("outlay/getList")}',
        where: {status: 'rejected'},
        toolbar: '#toolbarDemo',
        defaultToolbar: ['filter', 'exports', 'print'],
        cols: [[
            {type: "checkbox", width: 50},
            {field: 'id', width: 80, title: 'ID', sort: true},
            {field: 'uid', width: 100, title: '代理ID'},
            {field: 'money', width: 120, title: '提现金额', templet: function(d){
                return '￥' + parseFloat(d.money).toFixed(2);
            }},
            {field: 'image', width: 120, title: '收款码', templet: function(d){
                if(d.image && d.image.trim() !== '') {
                    return '<img src="' + d.image + '" style="width: 50px; height: 50px; object-fit: cover; cursor: pointer;" onclick="layer.photos({photos: {data: [{src: \'' + d.image + '\'}]}, anim: 5});">';
                } else {
                    return '<span style="color: #999;">未上传</span>';
                }
            }},
            {field: 'create_time', width: 160, title: '申请时间', templet: function(d){
                if(d.create_time && d.create_time > 0) {
                    return layui.util.toDateString(d.create_time * 1000, 'yyyy-MM-dd HH:mm:ss');
                } else {
                    return '<span style="color: #999;">-</span>';
                }
            }},
            {field: 'refuse_time', width: 160, title: '拒绝时间', templet: function(d){
                if(d.refuse_time && d.refuse_time > 0) {
                    return layui.util.toDateString(d.refuse_time * 1000, 'yyyy-MM-dd HH:mm:ss');
                } else {
                    return '<span style="color: #999;">-</span>';
                }
            }},
            {field: 'remark', width: 200, title: '拒绝原因'},
            {field: 'status', width: 100, title: '状态', templet: function(d){
                return '<span class="layui-badge layui-bg-red">已拒绝</span>';
            }},
            {title: '操作', width: 150, templet: '#currentTableBar', fixed: "right", align: "center"}
        ]],
        limits: [10, 15, 20, 25, 50, 100],
        limit: 15,
        page: true
    });

    // 监听工具条
    table.on('tool(currentTable)', function (obj) {
        var data = obj.data;
        if (obj.event === 'detail') {
            layer.open({
                type: 1,
                title: '提现详情',
                content: '<div style="padding: 20px;">' +
                    '<p><strong>提现ID:</strong> ' + data.id + '</p>' +
                    '<p><strong>代理ID:</strong> ' + data.uid + '</p>' +
                    '<p><strong>提现金额:</strong> ￥' + parseFloat(data.money).toFixed(2) + '</p>' +
                    '<p><strong>收款码:</strong> ' + (data.image ? '<img src="' + data.image + '" style="width: 100px; height: 100px; object-fit: cover;">' : '未上传') + '</p>' +
                    '<p><strong>申请时间:</strong> ' + (data.create_time ? layui.util.toDateString(data.create_time * 1000, 'yyyy-MM-dd HH:mm:ss') : '-') + '</p>' +
                    '<p><strong>拒绝时间:</strong> ' + (data.refuse_time ? layui.util.toDateString(data.refuse_time * 1000, 'yyyy-MM-dd HH:mm:ss') : '-') + '</p>' +
                    '<p><strong>拒绝原因:</strong> ' + (data.remark || '-') + '</p>' +
                    '</div>',
                area: ['500px', '400px']
            });
        } else if (obj.event === 'reprocess') {
            layer.confirm('确定重新处理这笔提现吗？', function (index) {
                // 这里可以添加重新处理的逻辑
                layer.msg('功能开发中...', {icon: 0});
                layer.close(index);
            });
        }
    });
});
</script>

<script type="text/html" id="currentTableBar">
    <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
    <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="reprocess">重新处理</a>
</script>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="export">导出数据</button>
    </div>
</script>
