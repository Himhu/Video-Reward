<div class="layuimini-container">
    <div class="layuimini-main">

        <form class="layui-form" action="" lay-filter="example">

            <div class="layui-form-item">
                <label class="layui-form-label required">API地址</label>
                <div class="layui-input-block">
                    <input type="text" name="api_url" lay-verify="required" lay-reqtext="API地址不能为空" 
                           placeholder="请输入API地址" value="http://czcz11.ltcdrc.cn/api/resource/getList" class="layui-input">
                    <tip>采集数据的API接口地址</tip>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label required">API密钥</label>
                <div class="layui-input-block">
                    <input type="text" name="api_key" lay-verify="required" lay-reqtext="API密钥不能为空" 
                           placeholder="请输入API密钥" value="BFTWo000o9U3VRPeLkoo00o4nX0xxy7mqmFZ6BQWF3tvnRrez1pdtbNT6IjE4a2ZKwNqFvmeZNN9Mg3pqNYCATCshqWIOg" class="layui-input">
                    <tip>API接口的访问密钥</tip>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">每页数量</label>
                <div class="layui-input-block">
                    <input type="number" name="page_limit" placeholder="请输入每页采集数量" value="50" class="layui-input">
                    <tip>每次采集的数据数量，建议不超过100</tip>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">默认分类</label>
                <div class="layui-input-block">
                    <select name="default_category" lay-verify="">
                        <option value="0">自动识别</option>
                        {volist name="categories" id="category"}
                        <option value="{$category.id}">{$category.ctitle}</option>
                        {/volist}
                    </select>
                    <tip>无法识别分类时使用的默认分类</tip>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">自动保存</label>
                <div class="layui-input-block">
                    <input type="radio" name="auto_save" value="1" title="开启">
                    <input type="radio" name="auto_save" value="0" title="关闭" checked>
                    <tip>是否在采集时自动保存到数据库</tip>
                </div>
            </div>

            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认保存</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>

        </form>

    </div>
</div>

<script>
    layui.use(['form', 'layer'], function () {
        var $ = layui.jquery,
            form = layui.form,
            layer = layui.layer;

        // 监听提交
        form.on('submit(saveBtn)', function (data) {
            var index = layer.msg('数据提交中，请稍候', {icon: 16, time: false, shade: 0.8});
            
            $.post('{:url("config")}', data.field, function (result) {
                layer.close(index);
                if (result.code === 1) {
                    layer.msg(result.msg, {icon: 1});
                    // 关闭当前弹窗
                    var iframeIndex = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(iframeIndex);
                } else {
                    layer.msg(result.msg, {icon: 2});
                }
            });
            return false;
        });

    });
</script>
