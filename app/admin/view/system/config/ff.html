<form id="app-form" class="layui-form layuimini-form" lay-filter="example">

    <div class="layui-form-item">
        <label class="layui-form-label">URLåŠ å¯†</label>
        <div class="layui-input-block">
            <input type="checkbox" lay-filter="ff_close" name="" {if sysconfig('ff','ff_close') == 1}checked{/if} value="{:sysconfig('ff','ff_close')}" lay-skin="switch" lay-text="ON|OFF">
            <div class="layui-word-aux" style="color: #666; margin-top: 8px; display: block;">
                å¯ç”¨åå¯¹ç”Ÿæˆçš„é“¾æ¥è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œå¢åŠ è¯†åˆ«éš¾åº¦
            </div>
        </div>

    </div>

    <input type="hidden" id="ff_close" name="ff_close" value="{:sysconfig('ff','ff_close')}">


    <div class="layui-form-item">
        <label class="layui-form-label">åŸŸåéšæœºå‰ç¼€</label>
        <div class="layui-input-block">
            <input type="checkbox" lay-filter="ff_fix" name="" {if sysconfig('ff','ff_fix') == 1}checked{/if} value="{:sysconfig('ff','ff_fix')}" lay-skin="switch" lay-text="ON|OFF">
            <div class="layui-word-aux" style="color: #666; margin-top: 8px; display: block;">
                å¯ç”¨åç³»ç»Ÿå°†ä¸ºåŸŸåè‡ªåŠ¨æ·»åŠ éšæœºå‰ç¼€ï¼Œæå‡é˜²æŠ¤æ•ˆæœ
            </div>
        </div>
    </div>

    <input type="hidden" id="ff_fix" name="ff_fix" value="{:sysconfig('ff','ff_fix')}">



    <div class="layui-form-item">
        <label class="layui-form-label">ç¦æ­¢pcç«¯æ‰“å¼€</label>
        <div class="layui-input-block">
            <input type="checkbox" lay-filter="ff_pc" name="" {if sysconfig('ff','ff_pc') == 1}checked{/if} value="{:sysconfig('ff','ff_pc')}" lay-skin="switch" lay-text="ON|OFF">
            <div class="layui-word-aux" style="color: #666; margin-top: 8px; display: block;">
                å¯ç”¨åé™åˆ¶PCç«¯è®¾å¤‡è®¿é—®ï¼Œä»…å…è®¸ç§»åŠ¨ç«¯ç”¨æˆ·è®¿é—®
            </div>
        </div>
    </div>

    <input type="hidden" id="ff_pc" name="ff_pc" value="{:sysconfig('ff','ff_pc')}">



    <div class="layui-form-item">
        <label class="layui-form-label">é»˜è®¤ä¸­è½¬åŸŸå</label>
        <div class="layui-input-block">
            <input type="text" name="ff_domain" class="layui-input" placeholder="è¯·è¾“å…¥é»˜è®¤ä¸­è½¬åŸŸå" value="{:htmlspecialchars(sysconfig('ff','ff_domain'), ENT_QUOTES, 'UTF-8')}">
            <div class="layui-form-mid layui-word-aux">å¡«å†™é»˜è®¤ä¸­è½¬åŸŸåï¼Œç”¨äºé˜²æ´ªå’Œå†…å®¹åˆ†å‘ã€‚</div>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">URLåŠ å¯†åœ°å€</label>
        <div class="layui-input-block">
            <input type="text" name="ff_url" class="layui-input"  placeholder="è¯·è¾“å…¥urlåŠ å¯†å…¥å£åœ°å€" value="{:htmlspecialchars(sysconfig('ff','ff_url'), ENT_QUOTES, 'UTF-8')}">
            <div class="layui-form-mid layui-word-aux">ç”¨äºURLåŠ å¯†çš„å‰ç¼€åŸŸåï¼Œå»ºè®®ä½¿ç”¨å¯ä¿¡çš„çŸ­é“¾æ¥æœåŠ¡åŸŸå</div>
        </div>
    </div>





    <!-- çŸ­åœ°å€é…ç½®å·²ç§»è‡³ç‹¬ç«‹çš„é…ç½®é¡µé¢ -->




    <div class="hr-line"></div>
    <div class="layui-form-item text-center">
        <button type="submit" class="layui-btn layui-btn-normal layui-btn-sm" lay-filter="demo1"  lay-submit="system.config/save" data-refresh="false">æ‰¹é‡ä¿å­˜</button>
        <button type="reset" class="layui-btn layui-btn-primary layui-btn-sm">é‡ç½®</button>
        <div class="layui-form-mid layui-word-aux" style="color: #009688; margin-top: 10px;">
            ğŸ’¡ æç¤ºï¼šå¼€å…³ç±»é…ç½®ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œæ–‡æœ¬ç±»é…ç½®éœ€è¦ç‚¹å‡»"æ‰¹é‡ä¿å­˜"æŒ‰é’®
        </div>
    </div>

</form>

<script>
    layui.use(['form', 'layedit', 'laydate'], function(){

        var form = layui.form, layer = layui.layer;

        // è‡ªåŠ¨ä¿å­˜é…ç½®é¡¹
        function autoSaveConfig(name, value) {
            return new Promise(function(resolve, reject) {
                $.ajax({
                    url: 'autoSave',
                    method: 'POST',
                    data: {
                        name: name,
                        value: value
                    },
                    success: function(result) {
                        if (result.code === 1) {
                            resolve(result);
                        } else {
                            reject(result.msg || 'ä¿å­˜å¤±è´¥');
                        }
                    },
                    error: function(xhr, status, error) {
                        reject('ç½‘ç»œé”™è¯¯: ' + error);
                    }
                });
            });
        }

        // é€šç”¨å¼€å…³å¤„ç†å‡½æ•° - æ”¯æŒè‡ªåŠ¨ä¿å­˜
        function handleSwitchChange(switchName, targetId) {
            form.on('switch(' + switchName + ')', function(data) {
                try {
                    var hiddenInput = document.getElementById(targetId);
                    var newValue = this.checked ? '1' : '0';
                    var switchElement = this;

                    console.log('å¼€å…³å˜åŒ–:', switchName, 'æ–°å€¼:', newValue);

                    if (hiddenInput) {
                        hiddenInput.value = newValue;
                        console.log('éšè—å­—æ®µå·²æ›´æ–°:', targetId, '=', newValue);

                        // æ˜¾ç¤ºä¿å­˜ä¸­æç¤º
                        var loadingIndex = layer.load(2, {shade: [0.1,'#fff']});

                        // è‡ªåŠ¨ä¿å­˜é…ç½®
                        autoSaveConfig(targetId, newValue)
                            .then(function(result) {
                                layer.close(loadingIndex);
                                layer.msg('é…ç½®å·²è‡ªåŠ¨ä¿å­˜', {
                                    icon: 1,
                                    time: 2000
                                });
                            })
                            .catch(function(error) {
                                layer.close(loadingIndex);
                                console.error('è‡ªåŠ¨ä¿å­˜å¤±è´¥:', error);

                                // ä¿å­˜å¤±è´¥æ—¶æ¢å¤å¼€å…³çŠ¶æ€
                                switchElement.checked = !switchElement.checked;
                                hiddenInput.value = switchElement.checked ? '1' : '0';
                                form.render('checkbox');

                                layer.msg('ä¿å­˜å¤±è´¥: ' + error, {
                                    icon: 2,
                                    time: 3000
                                });
                            });
                    } else {
                        console.error('Hidden input ' + targetId + ' not found');
                        layer.msg('é…ç½®æ›´æ–°å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    }
                } catch (error) {
                    console.error('Switch handler error:', error);
                    layer.msg('å¼€å…³çŠ¶æ€æ›´æ–°å¤±è´¥');
                }
            });
        }

        // ä½¿ç”¨é€šç”¨å‡½æ•°å¤„ç†æ‰€æœ‰å¼€å…³
        handleSwitchChange('ff_close', 'ff_close');
        handleSwitchChange('ff_pc', 'ff_pc');
        handleSwitchChange('ff_fix', 'ff_fix');
    })


</script>